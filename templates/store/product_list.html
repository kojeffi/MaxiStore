{% extends 'store/master.html' %}
{% block content %}
<br><br><br><br>
<div class="container mt-5">
    <!-- Breadcrumb Navigation -->
    <nav aria-label="breadcrumb">
        <h1>Products</h1>
    </nav>

    <!-- Dynamic Heading -->
    <div class="row mb-3">
        <div class="col-md-12">
            <h2 class="text-center">
                {% if query %}
                    Search Results for "{{ query }}"
                {% elif selected_category %}
                    Products in "{{ selected_category }}"
                {% else %}
                    All Products
                {% endif %}
            </h2>
        </div>
    </div>

    <!-- Filter, Sort, and Search Form -->
    <div class="row mb-4">
        <div class="col-md-4 justify-content-end">
            <div class="input-group mb-3 ml-md-3">
                <select name="category" class="custom-select">
                    <option value="">All Categories</option>
                    {% for category in categories %}
                    <option value="{{ category.id }}" {% if category.id == selected_category %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                    {% endfor %}
                </select>
                <select name="sort" class="custom-select ml-2">
                    <option value="name" {% if sort == 'name' %}selected{% endif %}>Name</option>
                    <option value="price" {% if sort == 'price' %}selected{% endif %}>Price</option>
                    <option value="date" {% if sort == 'date' %}selected{% endif %}>Newest</option>
                </select>
            </div>
            <div class="input-group-append ml-md-3">
                <a href="{% url 'product_list' %}" class="btn btn-secondary">All Products</a>
            </div>
        </div>
        <div class="col-md-4 justify-content-end">
            <form method="get" action="{% url 'search' %}" class="form-inline justify-content-center">
                <div class="input-group mb-3">
                    <input type="text" name="q" class="form-control" placeholder="Search Products..." value="{{ query }}">
                    <div class="input-group-append">
                        <button type="submit" class="btn btn-primary">Search</button>
                    </div>
                </div>
            
            </form>
            
        </div>
            <div class="col-md-4 justify-content-end">
                <p>{{ products|length }} products found</p>
            </div>
    </div>

  
    <!-- Loading Spinner (Visible during AJAX requests) -->
    <div id="loading-spinner" class="text-center" style="display:none;">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
</div>

<style>
    .product-card {
        transition: transform 0.3s ease;
        border: 1px solid #ddd;
        border-radius: 0.75rem;
        overflow: hidden;
    }

    .product-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }

    .card-img-top {
        height: 250px;
        object-fit: cover;
        border-bottom: 1px solid #ddd;
    }

    .card-title {
        font-size: 1.25rem;
        font-weight: bold;
        color: #333;
    }

    .card-text {
        font-size: 0.9rem;
        color: #666;
    }

    .btn-primary {
        background-color: #007bff;
        border-color: #007bff;
    }

    .btn-primary:hover {
        background-color: #0056b3;
        border-color: #0056b3;
    }

    .btn-secondary {
        background-color: #6c757d;
        border-color: #6c757d;
    }

    .btn-secondary:hover {
        background-color: #5a6268;
        border-color: #5a6268;
    }

    .input-group .form-control {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
    }

    .input-group-append .btn {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
    }

    .custom-select {
        border-radius: 0.25rem;
    }

    .pagination .page-item.active .page-link {
        background-color: #007bff;
        border-color: #007bff;
    }

    .pagination .page-link {
        color: #007bff;
    }

    .pagination .page-link:hover {
        color: #0056b3;
    }

    .pagination .page-item.disabled .page-link {
        color: #6c757d;
    }
</style>


<!-- Featured Start -->
<div class="container-fluid pt-5">
    <div class="container">
    <div class="row px-3">
        {% for product in products %}
        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
            <a href="{% url 'product_detail' product.id %}" class="card h-100 shadow border-0 rounded overflow-hidden text-decoration-none text-dark">
                {% if product.image %}
                <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.name }}">
                {% else %}
                <img src="https://via.placeholder.com/200" class="card-img-top" alt="No image available">
                {% endif %}
                <div class="card-body d-flex flex-column p-4">
                    <h5 class="card-title text-center">{{ product.name }}</h5>
                    <p class="card-text text-center product-price text-dark font-weight-bold" data-base-price="{{ product.price }}">Price: ${{ product.price }}</p> 
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
    </div>
</div>
<!-- Featured End -->

<style>
    .card {
        transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover {
        transform: translateY(-10px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    }
    .card img {
        height: 40vh;
        object-fit: cover;
    }
    .card-body {
        display: flex;
        flex-direction: column;
    }
    .card-body .icons i {
        font-size: 1.5rem;
        cursor: pointer;
        margin: 0 10px;
    }
    .card-body .icons i:hover {
        color: #007bff;
    }
    .card-body a {
        transition: color 0.3s;
    }
    .card-body a:hover {
        color: #007bff;
    }
    .row {
        padding-left: 20px;
        padding-right: 20px;
    }
    .card-title {
        text-decoration: none;
        color: #333;
        transition: color 0.3s;
    }
    .card-title:hover {
        color: #007bff;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
    const countryDropdownItems = document.querySelectorAll('.dropdown-item');
    const productPriceElements = document.querySelectorAll('.product-price');

    countryDropdownItems.forEach(item => {
        item.addEventListener('click', async (event) => {
            event.preventDefault();
            const currency = item.getAttribute('data-currency');
            const exchangeRate = await getExchangeRate(currency);
            updatePrices(exchangeRate, currency);
        });
    });

    async function getExchangeRate(currency) {
        const apiKey = 'https://v6.exchangerate-api.com/v6/562fe40dc90930eb43604ebf/latest/USD'; // Replace with your API key
        const apiUrl = `https://api.exchangerate-api.com/v4/latest/USD`;

        try {
            const response = await fetch(apiUrl);
            const data = await response.json();
            return data.rates[currency];
        } catch (error) {
            console.error('Error fetching exchange rate:', error);
            return 1; // Default to 1 if there's an error
        }
    }

    function updatePrices(exchangeRate, currency) {
        productPriceElements.forEach(element => {
            const basePrice = parseFloat(element.getAttribute('data-base-price'));
            const newPrice = (basePrice * exchangeRate).toFixed(2);
            element.textContent = `Price: ${currency} ${newPrice}`;
        });
    }
});

   </script>
    <!-- Include jQuery -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-0BrtGk+s9kP0f2Vo7PQ8CmG0X5Y6V/Utm1QfO1sYP7czFzT8i4McZg0/+/gHZ4ZzO/fBvdDQuulzAYvU1E+s4A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Include Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


{% endblock %}
